var DataBind=function(e){"use strict";return e.Binder=function(e,t){function n(e){console.log("value change: ",e);var t=a.querySelectorAll('[data-foreach$="in '+e+'"]');T(t,e),i(t);var n=a.querySelectorAll('[data-bind="'+e+'"]');p(n);var r=a.querySelectorAll('[data-class="'+e+'"]');l(r);var o=a.querySelectorAll('[data-class^="'+e+'("]');l(o)}function r(e,t){for(var n=[].slice.call(e),r=0;r<n.length;r++)for(var o=0;o<t.length;o++)n[r]===t[o]&&n.splice(r,1);return n}var o=t||window.document,a=o.querySelector("[data-scope="+e.scope+"]"),c={},u={};e.addValueChangedListener(n);var i=function(e){for(var t=0;t<e.length;t++){var n=e[t].querySelectorAll("[data-bind]");p(n);var r=e[t].querySelectorAll("[data-class]");l(r);var o=e[t].querySelectorAll("[data-click]");k(o);var c=a.querySelectorAll("[data-enter]");h(c)}},l=function(e){for(var t=0;t<e.length;t++)f(e[t])},f=function(t){var n=t.getAttribute("data-class"),r=c[n];r&&t.classList.remove(r);var o=e.get(n);c[n]=o,o&&t.classList.add(o)},s=function(){var e=a.querySelectorAll("[data-foreach]"),t=a.querySelectorAll("[data-foreach] [data-foreach]"),n=r(e,t);v(n),T(n);var o=a.querySelectorAll("[data-bind]");p(o);var c=a.querySelectorAll("[data-class]");l(c);var u=a.querySelectorAll("[data-click]");k(u);var i=a.querySelectorAll("[data-enter]");h(i)},h=function(e){for(var t=0;t<e.length;t++)d(e[t])},d=function(t){var n=t.getAttribute("data-enter");t.onkeydown=function(t){13===t.which&&e.invoke(n)}},k=function(e){for(var t=0;t<e.length;t++)m(e[t])},v=function(e){for(var t=0;t<e.length;t++){for(var n=[],r=0;r<e[t].children.length;r++)n.push(e[t].children[r].cloneNode(!0));var o=e[t].getAttribute("data-foreach"),a=o.split(" in ");u[o]={template:n,items:a[1].trim(),item:a[0].trim()}}},T=function(t){for(var n=0;n<t.length;n++){g(t[n]);for(var r=t[n].getAttribute("data-foreach"),o=u[r],a=e.get(o.items),c=0;c<a.length();c++)for(var i=0;i<o.template.length;i++){var l=o.template[i].cloneNode(!0);t[n].appendChild(l),x(l,"data-bind",o,c),x(l,"data-class",o,c),x(l,"data-click",o,c),x(l,"data-foreach",o,c)}}},g=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},x=function(e,t,n,r){var o=function(e){return e.replace(n.item,n.items+"["+r+"]")};if(e.hasAttribute(t)){var a=e.getAttribute(t),c=a.replace(new RegExp("^"+n.item+"(?=[.]|$)"),n.items+"["+r+"]").replace(new RegExp("[(,] *"+n.item+" *(?=[,)])","g"),o).replace(new RegExp(" in "+n.item+"$")," in "+n.items+"["+r+"]");e.setAttribute(t,c),"data-foreach"===t&&(v([e]),T([e]))}for(var u=0;u<e.children.length;u++)x(e.children[u],t,n,r)},m=function(t){var n=t.getAttribute("data-click");t.onclick=function(){e.invoke(n)}},p=function(e){for(var t=0;t<e.length;t++)S(e[t])},S=function(t){var n=t.getAttribute("data-bind"),r=e.get(n);void 0===r?e.attr(n,""):"checkbox"===t.type?(t.checked=r,t.onclick=function(){e.attr(n,t.checked)}):"radio"===t.type?(t.checked=r===t.value,t.onclick=function(){e.attr(n,t.value)}):"select"===t.tagName.toLowerCase()?(t.value=r,t.onchange=function(){e.attr(n,t.value)}):"text"===t.type||"textarea"===t.type?(t.value!==r&&(t.value=r),t.oninput=function(){e.attr(n,t.value)}):t.innerHTML=r};return{bind:s}},e}(DataBind||{}),DataBind=function(e){"use strict";return e.Model=function(e){function t(e){return o[e]}function n(e,t){o[e]=t}function r(e){c.forEach(function(t){t(e)}),a.hasOwnProperty(e)&&a[e].forEach(function(e){r(e)})}var o={},a={},c=[],u=new DataBind.Parser(r,t,n),i=function(e,t){u.attr(e,t)},l=function(e){return u.get(e)},f=function(e,t,n){n&&n.forEach(function(t){h(e,t)});for(var r=/this\.get\(['"]([^'"]+)['"]\)/g,a=r.exec(t.toString());null!=a;)h(e,a[1]),a=r.exec(t.toString());o[e]=t},s=function(e,t){o[e]=t},h=function(e,t){a[t]=a[t]||[],a[t].push(e)},d=function(e){c.push(e)};return{attr:i,get:l,computed:f,action:s,scope:e,addValueChangedListener:d,invoke:function(e){l(e)}}},e}(DataBind||{}),DataBind=function(e){"use strict";return e.Collection=function(e,t,n){var r=function(r){t.push(r),n(e)},o=function(){t.pop(),n(e)},a=function(r){t.forEach(function(e){r(e)}),n(e)},c=function(){t.length=0,n(e)};return{push:r,pop:o,value:t,length:function(){return t.length},forEach:a,clear:c}},e}(DataBind||{}),DataBind=function(e){"use strict";return e.Parser=function(e,t,n){var r=function(t,n){return Array.isArray(n)?new DataBind.Collection(t,n,e):n},o=function(e){var n=/^\d+$/;return n.test(e)?parseInt(e):t(e)},a=function(e,n){var r=e.currentToken().text;e.consume();var o=[];if("LPAREN"===e.currentToken().token){e.consume();for(var a="";e.hasNextToken()&&"RPAREN"!==e.currentToken().token;)"COMMA"===e.currentToken().token?(o.push(i(a)),a=""):a+=e.currentToken().text,e.consume();"RPAREN"===e.currentToken().token&&a&&o.push(i(a))}return t(r).apply(n,o)},c=function(e,n,r){return e.consume(),r?r[t(n)[e.currentToken().text]]:t(n)[e.currentToken().text]},u=function(e,n){var a=e.currentToken().text;if(e.consume(),"DOT"===e.currentToken().token)return c(e,a,n);if("LBRACK"===e.currentToken().token){e.consume();var u=o(e.currentToken().text);return t(a)[u]}return r(a,t(a))},i=function(e){for(var n=new DataBind.Lexer(e),c=null;n.hasNextToken();){if(n.consume(),"NUMBER"===n.currentToken().token)return parseInt(n.currentToken().text);if("LITERAL"===n.currentToken().token)return n.currentToken().text.slice(1,-1);"ID"===n.currentToken().token&&(c="function"==typeof t(n.currentToken().text)?a(n,this):u(n,c)),"DOT"===n.currentToken().token?(n.consume(),c=c[n.currentToken().text]):"LBRACK"===n.currentToken().token&&(n.consume(),c=c[o(n.currentToken().text)])}return r(e,c)},l=function(r,a){for(var c=[],u=null,i=new DataBind.Lexer(r);i.hasNextToken();){i.consume();var l;if("ID"===i.currentToken().token&&(l=i.currentToken().text,u||(u=t(l)),void 0===u&&(u={},n(l,u)),i.hasNextToken()||(n(l,a),e(l)),i.consume()),"LBRACK"===i.currentToken().token){c.push(l),i.consume();var s=i.currentToken().text,h=o(s);i.consume(),i.hasNextToken()?u=u[h]:(u[h]=a,e(r),f(c))}else"DOT"===i.currentToken().token&&(i.consume(),i.hasNextToken()?(u[i.currentToken().text]=u[i.currentToken().text]||{},u=u[i.currentToken().text]):(u[i.currentToken().text]=a,e(r),f(c)))}},f=function(t){t.forEach(function(t){e(t)})};return{get:i,attr:l}},e}(DataBind||{}),DataBind=function(e){"use strict";return e.Lexer=function(e){var t={root:[[/\[/,"LBRACK"],[/\]/,"RBRACK"],[/[(]/,"LPAREN"],[/[)]/,"RPAREN"],[/,/,"COMMA"],[/['][^']*[']/,"LITERAL"],[/["][^"]*["]/,"LITERAL"],[/[a-zA-Z][a-zA-Z0-9]*/,"ID"],[/[0-9]+/,"NUMBER"],[/[.]/,"DOT"],[/\s+/,TokenJS.Ignore]]},n=new TokenJS.Lexer(e,t,!1),r=n.tokenize(),o=-1,a=function(){return o<r.length-1};return{currentToken:function(){return o<r.length?r[o]:TokenJS.EndOfStream},consume:function(){o++},hasNextToken:a}},e}(DataBind||{}),TokenJS=TokenJS||{};TokenJS.Ignore={toString:function(){return"Ignored rule"}},TokenJS.EndOfStream={toString:function(){return"End of token stream"}},TokenJS.SyntaxError=function(e){this.name="SyntaxError",this.message=e},TokenJS.StateError=function(e){this.name="StateError",this.message=e},TokenJS.Lexer=function(e,t,n){var r,o=t,a=e,c=0,u=n,i=function(e){if(!o.hasOwnProperty(e))throw new TokenJS.StateError("Missing state: '"+e+"'.");r=e};i("root");var l=function(){if(c>=a.length)return TokenJS.EndOfStream;for(var e=r,t=f(),n=0;n<t.length;n++){var o=t[n];if("function"!=typeof o.value)return k(o.matchText),o.value===TokenJS.Ignore?l():{text:o.matchText,token:o.value,index:o.index};var i=o.value.call(x,o.matchText);if(i===TokenJS.Ignore)return k(o.matchText),l();if(g(i))return k(o.matchText),{text:o.matchText,token:i,index:o.index};h(e)&&d()}return u?(c+=1,l()):void d()},f=function(){for(var e=[],t=o[r],n=0;n<t.length;n++){var u=t[n][0],i=u.exec(a.substring(c));i&&0===i.index&&e.push({matchText:i[0],value:t[n][1],index:c})}return s(e),e},s=function(e){e.sort(function(e,t){return e.matchText.length<t.matchText.length?1:e.matchText.length>t.matchText.length?-1:0})},h=function(e){return r!==e},d=function(){throw new TokenJS.SyntaxError("Invalid character '"+a[c]+"' at index "+(c+1))},k=function(e){c+=e.length},v=function(){c=0,r="root"},T=function(){v();for(var e=[],t=l();t!==TokenJS.EndOfStream;)e.push(t),t=l();return e},g=function(e){return"undefined"!=typeof e&&null!==e},x={state:i};return{getNextToken:l,tokenize:T,state:i,reset:v}};